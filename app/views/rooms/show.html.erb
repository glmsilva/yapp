<%
  # Definição do Deck (Poderia estar num Helper ou Model no futuro)
  deck = ['0', '1', '2', '3', '5', '8', '13', '21', '34', '55', '?', '☕']

  # Identifica o voto atual do usuário para marcar o botão como "ativo"
  current_vote = @current_player.vote&.value
%>

<%= turbo_stream_from @room %>

<div class="flex flex-col h-full relative pb-40"> <div class="flex flex-col md:flex-row items-center justify-between mb-8 p-4 bg-slate-800/50 rounded-xl border border-slate-700 gap-4">
    <div>
      <h1 class="text-xl font-bold text-white flex items-center gap-2">
        <span class="text-indigo-400">#</span> <%= @room.slug_name %>
      </h1>
      <p class="text-sm text-slate-400">
        <%= @players.count %> participantes na sala
      </p>
    </div>

    <div class="flex gap-2">
      <% if @current_player.moderator? %>
        <% if @room.revealed? %>
          <%= button_to room_reset_path(@room.slug_name), method: :post, class: "px-4 py-2 bg-slate-600 hover:bg-slate-700 text-white rounded-lg font-medium text-sm flex items-center transition" do %>
            <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" class="w-5 h-5 mr-2"><path stroke-linecap="round" stroke-linejoin="round" d="M16.023 9.348h4.992v-.001M2.985 19.644v-4.992m0 0h4.992m-4.993 0l3.181 3.183a8.25 8.25 0 0013.803-3.7M4.031 9.865a8.25 8.25 0 0113.803-3.7l3.181 3.182m0-4.991v4.99" /></svg>
            Nova Rodada
          <% end %>
        <% else %>
          <%= button_to room_reveal_path(@room.slug_name), method: :post, class: "px-4 py-2 bg-indigo-600 hover:bg-indigo-700 text-white rounded-lg font-medium text-sm flex items-center transition shadow-lg shadow-indigo-500/20" do %>
            <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" class="w-5 h-5 mr-2"><path stroke-linecap="round" stroke-linejoin="round" d="M2.036 12.322a1.012 1.012 0 010-.639C3.423 7.51 7.36 4.5 12 4.5c4.638 0 8.573 3.007 9.963 7.178.07.207.07.431 0 .639C20.577 16.49 16.64 19.5 12 19.5c-4.638 0-8.573-3.007-9.963-7.178z" /><path stroke-linecap="round" stroke-linejoin="round" d="M15 12a3 3 0 11-6 0 3 3 0 016 0z" /></svg>
            Revelar Cartas
          <% end %>
        <% end %>
      <% end %>

      <button onclick="navigator.clipboard.writeText(window.location.href); alert('Link copiado!')" class="px-4 py-2 bg-slate-700 hover:bg-slate-600 text-slate-200 rounded-lg font-medium text-sm flex items-center transition">
        <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" class="w-5 h-5 mr-2"><path stroke-linecap="round" stroke-linejoin="round" d="M15.75 17.25v3.375c0 .621-.504 1.125-1.125 1.125h-9.75a1.125 1.125 0 01-1.125-1.125V7.875c0-.621.504-1.125 1.125-1.125H6.75a9.06 9.06 0 011.5.124m7.5 10.376h3.375c.621 0 1.125-.504 1.125-1.125V11.25c0-4.46-3.243-8.161-7.5-8.876a9.06 9.06 0 00-1.5-.124H9.375c-.621 0-1.125.504-1.125 1.125v3.5m7.5 10.375H9.375a1.125 1.125 0 01-1.125-1.125v-9.25m12 6.625v-1.875a3.375 3.375 0 00-3.375-3.375h-1.5a1.125 1.125 0 01-1.125-1.125v-1.5a3.375 3.375 0 00-3.375-3.375H9.75" /></svg>
        Convidar
      </button>
    </div>
  </div>

  <div class="flex-grow flex justify-center">
    <div id="players_grid" class="grid grid-cols-2 md:grid-cols-3 lg:grid-cols-5 gap-6 w-full max-w-6xl content-start">
      <%= render @players %>
    </div>
  </div>

  <div class="fixed bottom-0 left-0 w-full bg-slate-900/95 backdrop-blur-md border-t border-slate-800 p-4 z-40 shadow-2xl">
    <div class="max-w-7xl mx-auto flex flex-col items-center">
       <p class="text-xs text-slate-400 mb-3 uppercase tracking-wider font-semibold">Escolha sua carta</p>

       <div class="flex gap-3 overflow-x-auto w-full justify-start md:justify-center pb-2 px-4 no-scrollbar">
          <% deck.each do |card_value| %>
            <% is_selected = (card_value == current_vote) %>

            <%= button_to votes_path, params: { vote: { value: card_value } }, method: :post, class: "group" do %>
                <div class="w-14 h-20 rounded-lg border-2 flex items-center justify-center text-xl font-bold transition-all transform hover:-translate-y-2 hover:shadow-xl
                  <%= is_selected ?
                      'bg-indigo-600 border-indigo-400 text-white ring-2 ring-indigo-500 ring-offset-2 ring-offset-slate-900' :
                      'bg-slate-800 border-slate-700 text-slate-300 hover:bg-slate-750 hover:border-indigo-500/50'
                  %>">
                  <%= card_value %>
                </div>
            <% end %>

          <% end %>
       </div>
    </div>
  </div>

</div>
